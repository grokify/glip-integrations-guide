# Dimelo Digital - Chat Bot integration guide

## Intention

The aim of this document is to describe the process of integrating a multi-channel bot into the Dimelo Digital platform. The tasks used to connect a bot to one of Dimelo’s sources can be used again for other sources.

Dimelo recommends using bots on private channels or at least on a third-party source connected via SDK. However Dimelo does not recommend its upload on public platforms such as Facebook, Twitter, etc because automatic messages are often banned.

A bot allows you to:

* prequalify a client inquiry
* take care of a request with low added-value
* retrieve information necessary to the processing of the request by an agent

**Please note: To this day Dimelo only supports messages in plain text format, Dimelo does not support enriched messages or HTML within the integration of a multi-channel bot. Dimelo is currently studying an extension to support enriched messages.**

The process of integrating a multi-channel bot that Dimelo recommends is described below.

## Prerequisites

This document aims to describe the process of integration of a multi-channel bot within Dimelo’s architecture. It does not describe the operating of the tools used for the integration nor does it explain the life-cycle of messages within Dimelo Digital. A thorough knowledge of Dimelo tools and of its operating is necessary to comprehend the entire process described in this documentation.

Below is a list of documentation that we recommend you read carefully beforehand:

* **DD Webhook API:** Functionality that allows automatic events concerning the message’s life-cycle from Dimelo Digital Platform to be sent to a predefined url
  * Documentation:​ ​https://bit.ly/dimelo_webhook_api
* **DD REST API:​** Dimelo Digital ‘s API which allows to retrieve data stored in it.
  * Documentation:​ ​https://bit.ly/dimelo_REST_API

## Functioning

The process of integrating a multi-channel bot prescribed by Dimelo is described below. In order to complete it effectively, the intervention of an external integrator and potentially of other contractors may be necessary. All interactions and actions between Dimelo Digital and the other components must transit through a proxy, which can be either included within the bot or be the link between the bot’s API’s and Dimelo’s. The proxy will be in charge of retrieving events sent by Dimelo, to generate API requests necessary to the interaction between Dimelo and the IA, and to format answers generated by the IA, etc.

<<IMAGE>>

The main advantage of this architecture is the flexibility of integration it allows to the intermediary, the proxy, installed between the Dimelo environment and the AI.


### Description of the components
You will find below the description of different elements composing the integration architecture of a multi-channel bot between the Dimelo Digital tool and the AI.

#### Dimelo Components

The detail of the components managed and/or provided by Dimelo is explained here:

**Dimelo Digital:**

Dimelo Digital is a platform within which your customer care agents connect in order to answer messages that are routed to them from varied connected channels. The platform allows you:

* To insure a consistent level of service for all customers by orienting the inquiries according to your SLA, customer’s profiles, and the availabilities of your resources.
* To streamline all different flux descended from social media, emails, forums, etc in order to guarantee an efficient operating system, traced exchanges, and treatment of interactions on a larger scale.
* To give you the tools to become more efficient and to pleasantly surprise your customers which will turn them into your first ambassadors. To go from one social identity to another to answer customers wherever they find themselves.
* To promote a better processing of customer inquiries by rerouting messages to the appropriate experts, suggesting answers, and filtering messages hindering the processing of the request since Dimelo Digital is established on a self-learning algorithm to identify the reasons of contact.

*Webhook API:* API sending automatic events linked to the life-cycle of messages managed by agents towards an established endpoint. For example, an event is automatically sent when a message arrives in the Dimelo Digital platform. The event is sent by HTTP request in JSON format and contains the message’s data (type of action carried out, date of the action, information specific to the message, ...).

*REST API Dimelo Digital:* API that enables to access data stored in Dimelo Digital. To access this data you need to acquire a valid ID token and have all the rights entitling you to access the information you are looking for. This API will retrieve the data relative to customer advisors, different user entities (Facebook, Twitter, Forum,...), interventions, messages,...

This component can be useful to retrieve additional data that might not have been correctly sent to the proxy through Dimelo Digital via Webhook events.

#### Components integration/bot

The components managed and/or provided by the integrator are specified in this section.

**AI:**
Component that generates answers automatically depending on the messages submitted by the proxy. This component can replace the agent for a first-level treatment of customer inquiries. In the case where the component is no longer able to answer, the conversation will be transferred to an agent.

**Proxy:**
Server hosting an app (server-side), this component is at the heart of the integration of Dimelo Digital and the AI. This component is in charge of nearly all the interactions between Dimelo Digital and the AI:

* Inboxing events and generating automatic actions from the AI’s side
* Recovering additional data via APIs that Dimelo provides
* Relaying messages received by Dimelo Digital towards the AI
* Formating answers that the AI will give
* Send answers generated by the AI to Dimelo Digital

*Recommendation:​* The proxy must be accessible in HTTPS format for obvious privacy reasons, to
encrypt the stream of data travelling between the component and Dimelo Digital.

### Implementation

Below is the detail of the different informations you will have to provide while initializing the multi-channel bot, as well as the outlines of each part and the condition tests to be done at the moment of launching of the integration.

#### Data to submit

A certain amount of data and actions are required to launch a multi-channel bot integration project, outside of the information relative to the setup of Dimelo Digital. These informations are listed below by party:

**On Dimelo’s part:**

* Account to access Dimelo Digital
* Token with all the necessary clearances to access Dimelo Digital’s APIs
Implementation

**On the integrator’s side**

* List of requested events and endpoint for the usage of API webhook
* Information relative to the setup of a bot agent account
* Categories allowing to go from a bot conversation to an agent

#### Outlines

Below are the outlines of steps to follow for each part of the integration process of a multi-channel bot:

**On Dimelo’s part**

* Configuration specific to Dimelo’s tools (creation of accounts, webhook configuration, APP SDK configuration, API access creation,...)
* Provide documentation detailing Dimelo’s tools
* Support to technical teams engaged in the integration alongside Dimelo tools on the
client’s part.

**On the integrator’s part:**

* Setup of the proxy and of all the actions linked to this (inflow supervision, API calls, logic application, liabilities management)
* Setup of the API initiating automatic answers

#### Bot to agent transfer

In the case where the bot is no longer able to answer, the proxy will transfer the conversation to an agent. This transfer is managed by Dimelo via a modification of category. By default, conversations managed by the bot will have a category accessible only by the agent responsible for the bot. During the transfer, it is necessary to recategorize the conversation by using a category accessible to agents. The integrators can use this solution to implement the handover.

**Recategorizing the conversation thread via API:**

The integrator must recategorize the thread via REST Dimelo API (see section technical integration > Recategorizing a conversation). The integrator must attribute an available category so that the conversation is visible to agents.

#### Testing process

During the testing process, it is recommended to use a source for the test. This allows to test the integration of the multi-channel bot on Dimelo’s side in the real conditions of production without impacting all agents already using Dimelo Digital.

### Process of integration

In the setting of the integration of a multi-channel bot, two movements of integration must be expected during the developing phase. The processes of a successful case and of a failure case are described below.

#### Successful scenario

The successful case for the integration of a multi-channel bot within the Dimelo Digital tool corresponds to the process during which the AI manages to formulate a reply to the message sent by the proxy. This process unfolds as follows:

<------IMAGE ----->

**Recap of the process:**

1. Dimelo Digital receives a message.
2. The API Webhook sends automatically an event informing the proxy that a message was received in Dimelo Digital, this event contains the information linked to the received message.
3. The proxy retrieves additional information if necessary via API REST Dimelo Digital
4. The proxy sends the information collected to the AI via the Webhook.
5. The AI formulates an answer according to the data it has received
6. The AI conveys the generated answer to the proxy
7. The proxy formats the answer
8. The proxy injects the formated answer in Dimelo Digital via the REST APIs
9. The answer is transferred to the customer via the Dimelo digital synchronizer.

[Optional] The “agent answers” generated by the API do not open automatically an intervention (processing of a customer message by an agent) within Dimelo. However, it is possible to create an intervention via API to follow the statistics on the bot’s procedure and allow traceability of interventions in the CRM.

#### Failure scenario

The failure scenario of the integration of a multi-channel bot within the Dimelo Digital tool corresponds to the process during which the AI is not able to generate an answer to the message sent by the proxy. This process is explained below:

<----- IMAGE ----->


Recap of the process :
1. Dimelo Digital receives a message
2. The Webhook API sends automatically an event informing the proxy that a message has been received in Dimelo Digital, this event contains information regarding the received message.
3. If necessary, the proxy gathers additional information via the REST Dimelo Digital API
4. The proxy sends the data collected via the Webhook to the 
5. The AI fails to generate an answer
6. The AI notifies the proxy of failure to generate an answer
7. The proxy takes into account the AI’s failure
8. The proxy recategorizes the conversation involved via the REST Dimelo Digital API or via Dimelo’s guidelines engine by filtering with context specific data
9. An agent takes over the thread recategorized by the proxy
10. The agent’s answer is transmitted to the customer via Dimelo Digital’s synchronizer

## Technical integration

This part will deal with the different steps of a minimal technical integration that need to be put in motion on the integrator’s part. The elements described below allow different interactions summarized by successful scenarios and failure scenarios of the integration process of a multi-channel bot. It is however possible to integrate new interactions to answer operating needs, you will find the detail of how to do so in our technical documentation Webhook and REST API of Dimelo Digital.

### Webhook integration

Dimelo Digital includes a push API called Webhook which is used to notify an endpoint defined in real-time when a specific event occurs within the interface (message import, categorization of conversation thread, agent takes charge of a task, etc.)

#### Configuration

To configure the Webhook on Dimelo’s side, it is necessary to provide us with an endpoint towards which we can send events. Once this endpoint is provided, Dimelo will be able to configure the Webhook in order to transfer to you an event for each message imported on the channels managed by the bot. Once this configuration is setup, Dimelo will provide a secured token to use to validate the endpoint as described below.

#### Validation of the endpoint

The first thing to setup after the configuration of the Webhook is the reply to the validation request sent during the activation of the webhook, the request is in the following format:

HTTP GET request in the following format:

HTTP GET: ​`https://{endpoint client}?hub.mode=subscribe&hub.challenge={string aléatoire}&hub.verify_token={token provided by Dimelo}`

You must setup the following actions at the reception of the validation request:

* Check that the hub.mod parameter is equal to “subscribe”
* Check that the hub.verify_token parameter corresponds well to the token provided by Dimelo
* Reply with a status 22 and a body containing only the value transferred in the
parameters of `hub.challenge`

You can view an example of a reply to the validation request on a webhook of test setup by Dimelo:

`https://webhook-sample.herokuapp.com/dimelo-digital-prod/endpoint?hub.mode=subscribe&hub.challenge=jfkjdsvfqgbqsvbfqkv&hub.verify_token=xxxxxxxxxxxxxxxxx`

#### Managing events

Once the validation request has passed you will begin receiving events linked to the importation of messages in Dimelo on the channels concerned by the bot. The alerts will be in the following format:

**HTTP POST containing a JSON request in the following format:**

```json
{
  "id":"50df05692c64ac7799f09a98",
  "domain_id":"48cc6703bdae1462ce06a555",
  "events":[
    {
      "type":"content.imported",
      "id":"5950328914bf8a22305f446a",
      "issued_at":"2017-06-25T22:00:41.339Z",
      "resource":{
        "type":"answers/private_message",
        "id":"5950328814bf8abf7f79e3cb",
        "metadata":{
          "approval_required":false,
          "author_id":"536cbd9e7aa58d58f3000050",
          "body":"This is just one more test email, sent automatically",
          "body_input_format":"text",
          "creator_id":null,
          "date":"2017-06-26",
          "first_in_thread":false,
          "foreign_categories":[

          ],
          "foreign_id":"1056855",
          "has_attachment":false,
          "intervention_id":"541014eea90ffb3f600000ac",
          "in_reply_to_author_id":"4dcceb1f2f1a692a2a000057",
          "in_reply_to_id":"541015010f4ca111df0000b0",
          "source_id":"4f97fbea7aa58d073900344f",
          "status":"assigned",
          "thread_id":"541014e17aa58d8ccf000024",
          "thread_title":"This is a nagios check thread, please don't delete!",
          "created_from":"synchronizer",
          "private":true
        }
      }
    }
  ]
}
```



